<TrustFrameworkPolicy xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema" PolicySchemaVersion="0.3.0.0"
    TenantId="gpdevb2c.onmicrosoft.com" PolicyId="B2C_1A_SignInSignUp"
    PublicPolicyUri="http://gpdevb2c.onmicrosoft.com/B2C_1A_SignInSignUp" DeploymentMode="Development"
    UserJourneyRecorderEndpoint="urn:journeyrecorder:applicationinsights">
    <BasePolicy>
        <TenantId>gpdevb2c.onmicrosoft.com</TenantId>
        <PolicyId>B2C_1A_PolicyBase</PolicyId>
    </BasePolicy>
    <BuildingBlocks>
        <ClaimsTransformations>
          <ClaimsTransformation Id="Email_MFA_BuildRequestBody" TransformationMethod="GenerateJson">
                      <InputClaims>
                          <InputClaim ClaimTypeReferenceId="emailOTP" TransformationClaimType="personalizations.0.dynamic_template_data.otp"/>
                          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="personalizations.0.to.0.email"/>
                      </InputClaims>
                      <InputParameters>
                          <InputParameter Id="personalizations.0.dynamic_template_data.languagecode" DataType="string" Value="En"/>
                          <InputParameter Id="from.email" DataType="string" Value="mfa@gritsoftwaresystems.com"/>
                          <InputParameter Id="template_id" DataType="string" Value="d-fd6a1c8fd9f94c73a6db0cae7743478d"/>
                          <InputParameter Id="personalizations.0.dynamic_template_data.subject" DataType="string" Value="Email verification code"/>
                      </InputParameters>
                      <OutputClaims>
                          <OutputClaim ClaimTypeReferenceId="emailRequestBody" TransformationClaimType="outputClaim"/>
                      </OutputClaims>
                  </ClaimsTransformation>
          </ClaimsTransformations>
        </BuildingBlocks>
      <ClaimsProviders>
        <ClaimsProvider>
          <DisplayName>OTP Handling</DisplayName>
          <TechnicalProfiles>
            <TechnicalProfile Id="Email_MFA">
                          <DisplayName>Email_MFA</DisplayName>
                          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
                          <Metadata>
                              <Item Key="ServiceUrl">https://api.sendgrid.com/v3/mail/send</Item>
                              <Item Key="AuthenticationType">Bearer</Item>
                              <Item Key="SendClaimsIn">Body</Item>
                              <Item Key="ClaimUsedForRequestPayload">emailRequestBody</Item>
                          </Metadata>
                          <CryptographicKeys>
                              <Key Id="BearerAuthenticationToken" StorageReferenceId="B2C_1A_SendGridSecret"/>
                          </CryptographicKeys>
                          <InputClaims>
                              <InputClaim ClaimTypeReferenceId="emailRequestBody" DefaultValue=""/>
                          </InputClaims>
                          <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop"/>
                      </TechnicalProfile>
            </TechnicalProfiles>
          </ClaimsProvider>
        </ClaimsProviders>
    <RelyingParty>
        <DefaultUserJourney ReferenceId="userjourney-bb6df4e5-9def-7f5e-7a33-6ac253de56d8" />
        <UserJourneyBehaviors>
            <SingleSignOn Scope="Tenant" />
            <SessionExpiryType>Absolute</SessionExpiryType>
            <SessionExpiryInSeconds>900</SessionExpiryInSeconds>
            <JourneyInsights TelemetryEngine="ApplicationInsights"
                InstrumentationKey="3c6fb700-ea88-48fa-982f-596dce17316f"
                DeveloperMode="true" ClientEnabled="false"
                ServerEnabled="true" TelemetryVersion="1.0.0" />
            <ScriptExecution>Allow</ScriptExecution>
        </UserJourneyBehaviors>
        <TechnicalProfile Id="PolicyProfile">
            <DisplayName>Policy Profile</DisplayName>
            <Protocol Name="OpenIdConnect" />
            <OutputClaims>
                <OutputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="sub" />
                <OutputClaim ClaimTypeReferenceId="givenName" />
                <OutputClaim ClaimTypeReferenceId="surname" />
                <OutputClaim ClaimTypeReferenceId="signInName" />
            </OutputClaims>
            <SubjectNamingInfo ClaimType="sub" />
        </TechnicalProfile>
    </RelyingParty>
</TrustFrameworkPolicy>